首先需要对任务进行扩展。任务需要有：
- 任务运行状态：未初始化，准备执行，正在执行，已退出
- 任务控制块：管理程序执行过程的任务上下文，控制程序的执行与暂停
- 任务相关系统调用：应用程序与系统调用间的接口，用于程序主动暂停和退出

然后在应用真正运行前，需要CPU第一次从内核态进入用户态。初始化在创建`TaskManager`的全局实例时进行，它会在应用的任务控制块上构造一个用于第一次执行的任务的上下文，先调用`init_app_cx`构造该任务的`trap`上下文并压入内核栈顶，然后调用`goto_restore`构造每个任务保存在任务控制块中的任务上下文，这里会直接将`ra`寄存器设置到`__restore`，因此`__restore`中不需要`mv sp, a0`了。